<% layout('main') -%>
<% block('title').append(title) %>
<% block('style').append('<link href="/user/static/admin_template/css/datepicker3.css" rel="stylesheet">') %>
<% block('style').append('<link href="/user/static/admin_template/css/styles.css" rel="stylesheet">') %>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#sidebar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#"><span>Lumino</span>Admin</a>
            <ul class="user-menu">
                <li class="dropdown pull-right">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span
                            class="glyphicon glyphicon-user"></span> 你好, <%= username%> <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#"><span class="glyphicon glyphicon-user"></span> Profile</a></li>
                        <li><a href="#"><span class="glyphicon glyphicon-cog"></span> Settings</a></li>
                        <li><a href="/user/logout"><span class="glyphicon glyphicon-log-out"></span> 退出</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <!-- /.container-fluid -->
</nav>
<div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar">
    <form role="search">
        <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
        </div>
    </form>
    <ul class="nav menu">
        <%- partial('user/views/admin/menu.html', {menu:menu, current:current}) %>
    </ul>
    <div class="attribution">Design by: <a href="http://www.mengcms.cn" target="_blank" title="MengCMS">MengCMS</a>
    </div>
</div>
<!--/.sidebar-->
<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">
    <div class="row">
        <ol class="breadcrumb">
            <li><a href="#"><span class="glyphicon glyphicon-home"></span></a></li>
            <li class="active"><%= title%></li>
        </ol>
    </div><!--/.row-->

    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">用户总数: <span id="total"></span></h1>
        </div>
    </div><!--/.row-->

    <div class="row">
        <div class="col-xs-12 col-md-6 col-lg-3">
            <div class="panel panel-blue panel-widget ">
                <div class="row no-padding">
                    <div class="col-sm-3 col-lg-5 widget-left">
                        <em class="glyphicon glyphicon-l">今日</em>
                    </div>
                    <div class="col-sm-9 col-lg-7 widget-right">
                        <div class="large pt-10 pull-right" id="today">0</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-md-6 col-lg-3">
            <div class="panel panel-orange panel-widget">
                <div class="row no-padding">
                    <div class="col-sm-3 col-lg-5 widget-left">
                        <em class="glyphicon glyphicon-l">昨日</em>
                    </div>
                    <div class="col-sm-9 col-lg-7 widget-right">
                        <div class="large pt-10 pull-right" id="yesterday">0</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-md-6 col-lg-3">
            <div class="panel panel-teal panel-widget">
                <div class="row no-padding">
                    <div class="col-sm-3 col-lg-5 widget-left">
                        <em class="glyphicon glyphicon-l">本周</em>
                    </div>
                    <div class="col-sm-9 col-lg-7 widget-right">
                        <div class="large pt-10 pull-right" id="week">0</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-md-6 col-lg-3">
            <div class="panel panel-red panel-widget">
                <div class="row no-padding">
                    <div class="col-sm-3 col-lg-5 widget-left">
                        <em class="glyphicon glyphicon-l">本月</em>
                    </div>
                    <div class="col-sm-9 col-lg-7 widget-right">
                        <div class="large pt-10 pull-right" id="month">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-6 col-md-3">
            <div class="panel panel-default">
                <div class="panel-body easypiechart-panel">
                    <h4>今日新增</h4>
                    <div class="easypiechart" id="easypiechart-blue" data-percent="0" ><span class="percent" id="today_per">0%</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="panel panel-default">
                <div class="panel-body easypiechart-panel">
                    <h4>昨日新增</h4>
                    <div class="easypiechart" id="easypiechart-orange" data-percent="0" ><span class="percent" id="yesterday_per">0%</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="panel panel-default">
                <div class="panel-body easypiechart-panel">
                    <h4>本周新增</h4>
                    <div class="easypiechart" id="easypiechart-teal" data-percent="0" ><span class="percent" id="week_per">0%</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-6 col-md-3">
            <div class="panel panel-default">
                <div class="panel-body easypiechart-panel">
                    <h4>本月新增</h4>
                    <div class="easypiechart" id="easypiechart-red" data-percent="0" ><span class="percent" id="month_per">0%</span>
                    </div>
                </div>
            </div>
        </div>
    </div><!--/.row-->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">用户增长趋势(最近一个月)</div>
                <div class="panel-body">
                    <div class="canvas-wrapper">
                        <input type="hidden" id="chart_data_title" value="">
                        <input type="hidden" id="chart_data_content" value="">
                        <canvas class="main-chart" id="line-chart" height="200" width="600"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div><!--/.row-->


</div><!--/.main-->
<script src="/user/static/admin_template/js/bootstrap-datepicker.js"></script>
<script src="/user/static/admin_template/js/chart.min.js"></script>
<script src="/user/static/admin_template/js/chart-data.js"></script>
<script src="/user/static/admin_template/js/easypiechart.js"></script>
<script src="/user/static/admin_template/js/easypiechart-data.js"></script>
<script>

    $(function(){
        //用户总数
        $.get('/user/admin/statistics/total', function(data){
            $('#total').html(data.total);
        });
        //今日新增和比例
        $.get('/user/admin/statistics/today', function(data){
            $('#today').html(data.today);
        });
        $.get('/user/admin/statistics/today/per', function(data){
            if(data.today == 0){
                $('#today_per').html(0+'%');
                $('#today_per').parent().attr("data-percent",0);
            }else{
                var today = $('#today').html();
                $('#today_per').html((today/data.today).toFixed(2)+'%');
                $('#today_per').parent().attr("data-percent",(today/data.today).toFixed(2));
            }
            $('#easypiechart-blue').easyPieChart({
                scaleColor: false,
                barColor: '#30a5ff'
            });
        });


        //昨日新增和比例
        $.get('/user/admin/statistics/yesterday', function(data){
            $('#yesterday').html(data.yesterday);
        });
        $.get('/user/admin/statistics/yesterday/per', function(data){
            if(data.yesterday == 0){
                $('#yesterday_per').html(0+'%');
                $('#yesterday_per').parent().attr("data-percent",0);
            }else{
                var yesterday = $('#yesterday').html();
                $('#yesterday_per').html((yesterday/data.yesterday).toFixed(2)+'%');
                $('#yesterday_per').parent().attr("data-percent",(yesterday/data.yesterday).toFixed(2));
            }
            $('#easypiechart-orange').easyPieChart({
                scaleColor: false,
                barColor: '#ffb53e'
            });
        });


        //本周新增和比例
        $.get('/user/admin/statistics/week', function(data){
            $('#week').html(data.week);
        });
        $.get('/user/admin/statistics/week/per', function(data){
            if(data.week == 0){
                $('#week_per').html(0+'%');
                $('#week_per').parent().attr("data-percent",0);
            }else{
                var week = $('#week').html();
                $('#week_per').html((week/data.week).toFixed(2)+'%');
                $('#week_per').parent().attr("data-percent",(week/data.week).toFixed(2));
            }
            $('#easypiechart-teal').easyPieChart({
                scaleColor: false,
                barColor: '#1ebfae'
            });
        });


        //本月新增和比例
        $.get('/user/admin/statistics/month', function(data){
            $('#month').html(data.month);
        });
        $.get('/user/admin/statistics/month/per', function(data){
            if(data.month == 0){
                $('#month_per').html(0+'%');
                $('#month_per').parent().attr("data-percent",0)
            }else{
                var month = $('#month').html();
                $('#month_per').html((month/data.month).toFixed(2)+'%');
                $('#month_per').parent().attr("data-percent",(month/data.month).toFixed(2));

            }
            $('#easypiechart-red').easyPieChart({
                scaleColor: false,
                barColor: '#f9243f'
            });
        });
    })

    !function ($) {
        $(document).on("click", "ul.nav li.parent > a > span.icon", function () {
            $(this).find('em:first').toggleClass("glyphicon-minus");
        });
        $(".sidebar span.icon").find('em:first').addClass("glyphicon-plus");
    }(window.jQuery);

    $(window).on('resize', function () {
        if ($(window).width() > 768) $('#sidebar-collapse').collapse('show')
    })
    $(window).on('resize', function () {
        if ($(window).width() <= 767) $('#sidebar-collapse').collapse('hide')
    })
</script>
